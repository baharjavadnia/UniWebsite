<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم ورود نمره</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <head>
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
    
        .hover-effect:hover {
            background-color: #E5E7EB; /* رنگ مشابه صفحه قبلی */
        }
    
        .modal {
            max-height: 80vh;
            overflow-y: auto;
        }
    
        .grade-red {
            color: red;
        }
    
        .hover-grade {
            cursor: pointer;
            transition: color 0.3s, transform 0.3s;
        }
        .hover-grade:hover {
            color: #2563EB; /* آبی مشابه صفحه قبلی */
            transform: scale(1.2);
        }
    
        .hover-message {
            cursor: pointer;
            transition: color 0.3s, transform 0.3s;
        }
        .hover-message:hover {
            color: #EF4444; /* قرمز مشابه صفحه قبلی */
            transform: scale(1.5);
        }
    
        nav a {
            font-size: 14px;
        }
    
        #datetime {
            font-size: 14px;
        }
    
        .back-button {
            background-color: #1e40b0; /* Matches the header color */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .back-button:hover {
            transform: scale(1.1);
        }
    
        table {
            border-collapse: collapse;
            width: 100%;
        }
    
        th, td {
            border: 1px solid #D1D5DB;
            padding: 8px;
            text-align: right;
        }
    
        th {
            background-color: #1E3A8A;
            color: white;
        }
    
        footer {
            margin-top: auto;
            background-color: #1E3A8A;
            color: white;
            padding: 1rem;
            text-align: center;
        }
    </style>
    
</head>
<body class="bg-gray-100">

    <header class="flex justify-between items-center p-4 bg-blue-800 text-white"> 
        <div id="datetime" class="text-left ml-10"></div> 
        <nav class="flex space-x-4 ml-auto"> 
            <div class="flex space-x-4"> 
                <a href="#" class="hover:text-gray-300 mr-10">صفحه اصلی</a>  
                <a href="#" class="hover:text-gray-300 pr-10">آرشیو اخبار</a> 
                <a href="#" class="hover:text-gray-300 pr-10">اطلاعیه ها</a> 
                <a href="#" class="hover:text-gray-300 pr-10">سایت آموزش</a> 
                <a href="#" class="hover:text-gray-300 pr-10">سیستم پشتیبانی</a> 
                <a href="#" class="hover:text-gray-300 pr-10">تماس با ما</a> 
            </div> 
        </nav> 
    </header>
    

    <div class="container mx-auto mt-12 mb-8 flex-grow">
        <a href="teacher info.html" class="back-button mb-4">بازگشت</a>
        
        <div class="bg-white shadow-lg rounded-lg p-5 mt-4">
            <h1 class="text-xl text-right font-bold mb-5">جدول تدریس</h1>
            <table class="w-full text-right border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="border px-4 py-2">اعتراض دانشجو</th>
                        <th class="border px-4 py-2">تاریخ تدریس</th>
                        <th class="border px-4 py-2">وضعیت</th>
                        <th class="border px-4 py-2">نمره حداکثری</th>
                        <th class="border px-4 py-2">نمره حداقلی</th>
                        <th class="border px-4 py-2">نمره میانگین</th>
                        <th class="border px-4 py-2">تعداد دانشجو</th>
                        <th class="border px-4 py-2">نوع درس</th>
                        <th class="border px-4 py-2">تعداد واحد</th>
                        <th class="border px-4 py-2">ترم تدریس</th>
                        <th class="border px-4 py-2">کد درس</th>
                        <th class="border px-4 py-2">نام درس</th>
                        <th class="border px-4 py-2">شماره ردیف</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="hover-effect">
                        <td class="border px-4 py-2"><a href="#" class="text-red-600 hover:text-red-800">💬 2</a></td>
                        <td class="border px-4 py-2">۱۴۰۳/۱۰/۱۸</td>
                        <td class="border px-4 py-2">فعال</td>
                        <td class="border px-4 py-2">20</td>
                        <td class="border px-4 py-2">10</td>
                        <td class="border px-4 py-2">15</td>
                        <td class="border px-4 py-2">25</td>
                        <td class="border px-4 py-2">عملی</td>
                        <td class="border px-4 py-2">3</td>
                        <td class="border px-4 py-2">نیمسال 1</td>
                        <td class="border px-4 py-2">101</td>
                        <td class="border px-4 py-2"><a href="#" class="text-blue-600 hover:bg-blue-200" onclick="openModal('تصویر سازی', this)">تصویر سازی</a></td>
                        <td class="border px-4 py-2">1</td>
                    </tr>
                    <tr class="hover-effect">
                        <td class="border px-4 py-2"><a href="#" class="text-red-600 hover:text-red-800">💬 1</a></td>
                        <td class="border px-4 py-2">۱۴۰۳/۰۹/۲۸</td>
                        <td class="border px-4 py-2">فعال</td>
                        <td class="border px-4 py-2">18</td>
                        <td class="border px-4 py-2">12</td>
                        <td class="border px-4 py-2">17</td>
                        <td class="border px-4 py-2">30</td>
                        <td class="border px-4 py-2">عملی</td>
                        <td class="border px-4 py-2">3</td>
                        <td class="border px-4 py-2">نیمسال 1</td>
                        <td class="border px-4 py-2">102</td>
                        <td class="border px-4 py-2"><a href="#" class="text-blue-600 hover:bg-blue-200" onclick="openModal('طراحی کاراکتر', this)">طراحی کاراکتر</a></td>
                        <td class="border px-4 py-2">2</td>
                    </tr>
                    <tr class="hover-effect">
                        <td class="border px-4 py-2"><a href="#" class="text-red-600 hover:text-red-800">💬 0</a></td>
                        <td class="border px-4 py-2">۱۴۰۳/۱۰/۰۲</td>
                        <td class="border px-4 py-2">فعال</td>
                        <td class="border px-4 py-2">19</td>
                        <td class="border px-4 py-2">9</td>
                        <td class="border px-4 py-2">-</td>
                        <td class="border px-4 py-2">20</td>
                        <td class="border px-4 py-2">عملی/تئوری</td>
                        <td class="border px-4 py-2">3</td>
                        <td class="border px-4 py-2">نیمسال 1</td>
                        <td class="border px-4 py-2">103</td>
                        <td class="border px-4 py-2"><a href="#" class="text-blue-600 hover:bg-blue-200" onclick="openModal('مبانی رنگ شناسی', this)">مبانی رنگ شناسی</a></td>
                        <td class="border px-4 py-2">3</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="courseModal" class="fixed inset-0 flex items-center justify-center hidden bg-gray-800 bg-opacity-75">
        <div class="bg-white rounded-lg p-5 modal">
            <h2 class="text-lg font-bold mb-4 text-right" id="courseTitle"></h2>
            <table class="w-full text-right border-collapse">
                <thead>
                    <tr class="bg-gray-200 ">
                        <th class="border px-4 py-2">نتیجه نمره</th>
                        <th class="border px-4 py-2">وضعیت اعتراض</th>
                        <th class="border px-4 py-2">وضعیت قفل</th>
                        <th class="border px-4 py-2">نوع درس</th>
                        <th class="border px-4 py-2">وضع نمره</th>
                        <th class="border px-4 py-2">نمره</th>
                        <th class="border px-4 py-2">نام خانوادگی و نام</th>
                        <th class="border px-4 py-2">شماره دانشجو</th>
                    </tr>
                </thead>
                <tbody id="studentList">
                    <!-- اطلاعات دانشجویان در اینجا بارگذاری می‌شود -->
                </tbody>
            </table>
            <button onclick="saveGrades()" class="mt-5 bg-green-500 text-white px-4 py-2 rounded">ثبت نمرات</button>
            <button onclick="closeModal()" class="mt-2 bg-red-500 text-white px-4 py-2 rounded">بستن</button>
        </div>
    </div>

    <div id="complaintModal" class="fixed inset-0 flex items-center justify-center hidden bg-gray-800 bg-opacity-75">
        <div class="bg-white rounded-lg p-5 modal">
            <h2 class="text-lg font-bold mb-4">پیام‌های اعتراض دانشجو</h2>
            <div id="complaintMessage" class="mb-4"></div>
            <textarea id="responseText" class="border w-full p-2" placeholder="پاسخ استاد را اینجا بنویسید"></textarea>
            <div class="mt-2">
                <button onclick="sendResponse()" class="bg-green-500 text-white px-4 py-2 rounded">ارسال پاسخ</button>
                <button onclick="deleteResponse()" class="bg-red-500 text-white px-4 py-2 rounded">حذف</button>
            </div>
            <button onclick="closeComplaintModal()" class="mt-5 bg-red-500 text-white px-4 py-2 rounded">بستن</button>
        </div>
    </div>

    <footer class="bg-blue-800 text-white p-4">
        <div class="max-w-6xl mx-auto text-center">
            <p>© 2025 دانشکده هنر و معماری. تمامی حقوق محفوظ است.</p>
            <p>طراحی و توسعه توسط تیم فنی دانشگاه دانشگه خوارزمی</p>
        </div>
    </footer>

    <script>
        // نمایش تاریخ و ساعت
        function updateDateTime() {
            const now = new Date();
            const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false, timeZone: 'Asia/Tehran', locale: 'fa-IR' };
            document.getElementById('datetime').innerText = now.toLocaleString('fa-IR', options);
        }

        setInterval(updateDateTime, 1000); // به روز رسانی هر ثانیه

        const names = ['علی', 'محمد', 'سعید', 'مریم', 'نرگس', 'فاطمه', 'ریحانه', 'امیر', 'حسین', 'حامد', 'ناهید', 'ندا', 'آیدا', 'بهاره', 'نسرین'];
        const lastNames = ['احمدی', 'حسینی', 'محمدی', 'کریمی', 'نیکو', 'فخری', 'غفاری', 'پناهی', 'موسوی', 'شریفی', 'قاسمی', 'پورعلی', 'رضایی', 'محمودی', 'سلیمانی'];
        const complaints = [
            "نمره من باید بیشتر می‌بود.",
            "نمره من نادرست است.",
            "من با نمره‌ای که گرفتم مخالفم.",
            "لطفا نمره من را بازبینی کنید.",
            "سوالات امتحان با مطالب درس هماهنگ نبود."
        ];

        function openModal(courseName, linkElement) {
            document.getElementById("courseTitle").innerText = courseName;
            document.getElementById("courseModal").classList.remove("hidden");

            let studentList = document.getElementById("studentList");
            studentList.innerHTML = "";

            // پیدا کردن ردیف مربوطه
            const row = linkElement.closest('tr');
            const dateCell = row.cells[1]; // ستون تاریخ تدریس
            const currentDate = dateCell.innerText; // تاریخ فعلی

            // به روز رسانی تاریخ در ردیف مربوطه
            const updatedDate = new Date();
            const formattedDate = updatedDate.toLocaleDateString('fa-IR'); // فرمت تاریخ به زبان فارسی
            dateCell.innerText = formattedDate; // تاریخ جدید

            const studentCount = Math.floor(Math.random() * 16) + 15; // بین 15 تا 30 دانشجو
            let complaintCount = 0;

            for (let i = 0; i < studentCount; i++) {
                const studentNumber = `123${i}`;
                const fullName = `${names[Math.floor(Math.random() * names.length)]} ${lastNames[Math.floor(Math.random() * lastNames.length)]}`;
                const score = (courseName !== 'مبانی رنگ شناسی') ? (Math.random() * 20).toFixed(2) : '';
                const status = score ? 'اعلام شده' : 'اعلام نشده'; // تغییر در اینجا
                const lockStatus = ['قفل آموزش', 'اصلاح نمره'][Math.floor(Math.random() * 2)];
                let courseType;

                // تعیین نوع درس برای هر ردیف
                if (i < 2) {
                    courseType = 'عملی'; // برای ردیف اول و دوم
                } else {
                    courseType = 'عملی/تئوری'; // برای ردیف سوم
                }

                const result = score ? (score >= 10 ? 'قبول' : '<span class="grade-red">رد</span>') : 'اعلام نشده'; // تغییر در اینجا

                const complaintMessage = (status === 'اعلام شده' && Math.random() < 0.3) ? complaints[Math.floor(Math.random() * complaints.length)] : '';

                if (complaintMessage) {
                    complaintCount++;
                }

                studentList.innerHTML += `
                    <tr>
                        <td class="border px-4 py-2">${result}</td>
                        <td class="border px-4 py-2">${complaintMessage ? `<a href="#" class="text-red-600 hover:text-red-800 hover-message" onclick="openComplaintModal('${complaintMessage}')">💬</a>` : '-'}</td>
                        <td class="border px-4 py-2">
                            <select>
                                <option ${lockStatus === 'قفل آموزش' ? 'selected' : ''}>قفل آموزش</option>
                                <option ${lockStatus === 'اصلاح نمره' ? 'selected' : ''}>اصلاح نمره</option>
                            </select>
                        </td>
                        <td class="border px-4 py-2">${courseType}</td> <!-- نوع درس براساس ردیف -->
                        <td class="border px-4 py-2">${status}</td>
                        <td class="border px-4 py-2 hover-grade" onclick="editGrade(this)">${score || '-'}</td>
                        <td class="border px-4 py-2">${fullName}</td>
                        <td class="border px-4 py-2">${studentNumber}</td>
                    </tr>`;
            }

            const complaintIcon = document.querySelector(`tbody tr:nth-child(${document.querySelectorAll('tbody tr').length}) td:nth-child(1) a`);
            complaintIcon.innerText = `💬 ${complaintCount}`;
        }

        function closeModal() {
            document.getElementById("courseModal").classList.add("hidden");
        }

        function openComplaintModal(message) {
            document.getElementById("complaintMessage").innerText = message;
            document.getElementById("complaintModal").classList.remove("hidden");
        }

        function closeComplaintModal() {
            document.getElementById("complaintModal").classList.add("hidden");
            document.getElementById("responseText").value = '';
        }

        function sendResponse() {
            const responseText = document.getElementById("responseText").value;
            if (responseText) {
                alert("پاسخ به دانشجو ارسال شد.");
                closeComplaintModal();
            } else {
                alert("لطفا پاسخ را وارد کنید.");
            }
        }

        function deleteResponse() {
            document.getElementById("responseText").value = '';
            alert("پاسخ حذف شد.");
        }

        function editGrade(element) {
            let currentGrade = prompt("لطفا نمره را وارد کنید (بین 0 تا 20):", element.innerText);
            if (currentGrade !== null) {
                currentGrade = parseFloat(currentGrade);
                if (!isNaN(currentGrade) && currentGrade >= 0 && currentGrade <= 20) {
                    element.innerText = currentGrade.toFixed(2);
                    const row = element.parentElement;
                    const resultCell = row.cells[0];
                    const statusCell = row.cells[4];
                    resultCell.innerHTML = currentGrade >= 10 ? 'قبول' : '<span class="grade-red">رد</span>';
                    statusCell.innerText = 'اعلام شده';
                } else {
                    alert("نمره باید بین 0 تا 20 باشد.");
                }
            }
        }

        function saveGrades() {
            const studentRows = document.querySelectorAll("#studentList tr");
            let totalScore = 0;
            let minScore = Infinity;
            let maxScore = -Infinity;
            let count = 0;

            studentRows.forEach(row => {
                const scoreCell = row.cells[5];
                const score = parseFloat(scoreCell.innerText);
                if (!isNaN(score)) {
                    totalScore += score;
                    count++;
                    minScore = Math.min(minScore, score);
                    maxScore = Math.max(maxScore, score);
                }
            });

            const averageScore = count > 0 ? (totalScore / count).toFixed(2) : '-';
            const averageCell = document.querySelector("tbody tr:first-child td:nth-child(6)"); 
            const minCell = document.querySelector("tbody tr:first-child td:nth-child(5)"); 
            const maxCell = document.querySelector("tbody tr:first-child td:nth-child(4)"); 

            averageCell.innerText = averageScore;
            minCell.innerText = count > 0 ? minScore : '-';
            maxCell.innerText = count > 0 ? maxScore : '-';
            
            alert("نمرات با موفقیت ثبت شد.");
        }

        updateDateTime(); // اجرای اولیه برای نمایش تاریخ و ساعت
    </script>
</body>
</html>